# Stock Analyzer (Spring Boot + Gradle)

Spring Boot service that fetches recent market prices for a stock symbol and asks a local SLM (Ollama) to produce a concise descriptive analysis.

## Requirements
- Java 21
- Gradle (or use Docker)
- Ollama running locally and a model pulled
  - Default base URL: `http://localhost:11434`
  - Example model: `llama3.1:8b`

## Quick start (local)
```bash
cd /Users/harmighl1/cursor-poc/stock-analyzer-spring
gradle bootRun
```

Then call the API:
```bash
curl "http://localhost:8085/analyze?symbol=AAPL"
```

## Configuration
Defaults in `src/main/resources/application.yml`:
```yaml
server:
  port: 8085

ollama:
  baseUrl: http://localhost:11434
  model: llama3.1:8b

management:
  endpoints:
    web:
      exposure:
        include: health,info
```

You can override via environment variables when running:
- `OLLAMA_BASEURL` (e.g. `http://localhost:11434`)
- `OLLAMA_MODEL` (e.g. `llama3.1:8b`)

Example:
```bash
OLLAMA_BASEURL=http://localhost:11434 OLLAMA_MODEL=llama3.1:8b gradle bootRun
```

## Endpoints
- `GET /analyze?symbol=TSLA` — fetches the last month of prices for the symbol and returns a short analysis string generated by the SLM
- `GET /actuator/health` — health check
- `GET /actuator/info` — basic app info

## Install and run Ollama (macOS)
- With Homebrew (recommended):
```bash
brew install ollama
```
- Or download the mac app from `https://ollama.com` and open it once.

Start or verify the server and pull a model:
```bash
ollama serve            # if not using the GUI app; keep this running
ollama pull llama3.1:8b
ollama list
curl http://localhost:11434/api/tags
```

## Run with Docker
Build image and run the service container:
```bash
cd /Users/harmighl1/cursor-poc/stock-analyzer-spring
docker build -t stock-analyzer-spring .
docker run --rm -p 8085:8085 \
  -e OLLAMA_BASEURL=http://host.docker.internal:11434 \
  -e OLLAMA_MODEL=llama3.1:8b \
  stock-analyzer-spring
```

Then test:
```bash
curl "http://localhost:8085/analyze?symbol=AAPL"
```

Note (macOS Docker): use `host.docker.internal` so the container can reach the Ollama server on the host.

## Troubleshooting
- "Unable to find application 'Ollama'" on macOS:
  - Install via Homebrew (`brew install ollama`) or install/open the app from the website.
  - Ensure the server is running: `ollama serve` and `curl http://localhost:11434/api/tags`.
- Connection refused to `http://localhost:11434`:
  - Make sure Ollama is running and a model is pulled.
  - If running the Spring app in Docker, set `OLLAMA_BASEURL=http://host.docker.internal:11434`.
- Non-200 from `/analyze`:
  - Verify the symbol exists and market data source is reachable.
  - Check service logs for stack traces.

## Development
- Build jar: `gradle bootJar`
- Run tests: `gradle test`
- Local run: `gradle bootRun`

The app runs on `http://localhost:8085` by default.
