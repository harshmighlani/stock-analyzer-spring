# Stock Analyzer (Spring Boot + Gradle)

Spring Boot service that fetches recent market prices for a stock symbol and asks a local SLM (Ollama) to produce a concise descriptive analysis. **NEW**: Smart automation feature that runs daily at 9 PM to analyze stock news and generate recommendations.

## Features

### Core Analysis
- Fetch stock market data and generate AI-powered analysis using Ollama
- REST API endpoints for on-demand analysis

### Smart Automation (NEW!)
- **Daily automated analysis** at 9 PM EST
- **News scraping** from multiple free sources (Yahoo Finance, MarketWatch, SeekingAlpha, etc.)
- **Sentiment analysis** of stock news
- **Automated recommendations** (Strong Buy, Buy, Hold, Sell, Strong Sell)
- **Risk assessment** and target price calculations
- **File output** with daily recommendations
- **REST API** for accessing recommendations and dashboard

### Web Dashboard (NEW!)
- **Modern, responsive web interface** for viewing stock analysis results
- **Real-time data visualization** with interactive charts
- **Recommendation filtering** and detailed stock analysis
- **Risk distribution charts** and recommendation breakdowns
- **Individual stock analysis** with on-demand analysis trigger
- **Mobile-friendly design** with modern UI/UX

## Requirements
- Java 21
- Gradle (or use Docker)
- Ollama running locally and a model pulled (for core analysis only)
  - Default base URL: `http://localhost:11434`
  - Example model: `llama3.1:8b`

## Quick start (local)
```bash
cd /Users/harmighl1/cursor-poc/stock-analyzer-spring
gradle bootRun
```

### Access the Web Dashboard
Open your browser and navigate to:
```
http://localhost:8085
```

The dashboard provides a modern, interactive interface to:
- View latest stock recommendations
- Analyze individual stocks
- Trigger manual analysis
- View risk distributions and recommendation breakdowns
- Filter recommendations by type

### API Usage
You can also call the API directly:
```bash
curl "http://localhost:8085/analyze?symbol=AAPL"
```

## Automation API Endpoints

### Get Latest Recommendations
```bash
curl "http://localhost:8085/api/automation/recommendations"
```

### Get Recommendations by Symbol
```bash
curl "http://localhost:8085/api/automation/recommendations/AAPL"
```

### Trigger Manual Analysis
```bash
curl -X POST "http://localhost:8085/api/automation/trigger-analysis"
```

### Get Automation Status
```bash
curl "http://localhost:8085/api/automation/status"
```

### Get Dashboard Data
```bash
curl "http://localhost:8085/api/automation/dashboard"
```

## Dashboard Features

The web dashboard (`http://localhost:8085`) includes:

### üìä **Status Cards**
- Total stocks analyzed
- Last update time
- Strong buy recommendations count
- High-risk stocks count

### üìà **Interactive Charts**
- **Recommendation Distribution**: Pie chart showing breakdown of Strong Buy, Buy, Hold, Sell, Strong Sell
- **Risk Distribution**: Visual representation of Low, Medium, High risk stocks

### üìã **Recommendations Table**
- Sortable table with all latest recommendations
- Filter by recommendation type
- View detailed information for each stock
- Risk level indicators with color coding

### üîç **Individual Stock Analysis**
- Enter any stock symbol for on-demand analysis
- Real-time analysis results
- Detailed reasoning and recommendations

### ‚ö° **Real-time Controls**
- Refresh data button
- Trigger manual analysis
- Toast notifications for user feedback
- Loading indicators

## Configuration
Defaults in `src/main/resources/application.yml`:
```yaml
server:
  port: 8085

spring:
  datasource:
    url: jdbc:h2:mem:stockanalyzer
    driverClassName: org.h2.Driver
    username: sa
    password: password
  h2:
    console:
      enabled: true
      path: /h2-console
  jpa:
    hibernate:
      ddl-auto: create-drop
    show-sql: true

ollama:
  baseUrl: http://localhost:11434
  model: llama3.1:8b

management:
  endpoints:
    web:
      exposure:
        include: health,info,scheduledtasks
```

You can override via environment variables when running:
- `OLLAMA_BASEURL` (e.g. `http://localhost:11434`)
- `OLLAMA_MODEL` (e.g. `llama3.1:8b`)

Example:
```bash
OLLAMA_BASEURL=http://localhost:11434 OLLAMA_MODEL=llama3.1:8b gradle bootRun
```

## Endpoints

### Core Analysis
- `GET /analyze?symbol=TSLA` ‚Äî fetches the last month of prices for the symbol and returns a short analysis string generated by the SLM

### Automation Features
- `GET /api/automation/recommendations` ‚Äî get all latest stock recommendations
- `GET /api/automation/recommendations/{symbol}` ‚Äî get recommendations for specific symbol
- `POST /api/automation/trigger-analysis` ‚Äî manually trigger daily analysis
- `GET /api/automation/status` ‚Äî get automation status and statistics
- `GET /api/automation/dashboard` ‚Äî get dashboard data with top recommendations

### System
- `GET /actuator/health` ‚Äî health check
- `GET /actuator/info` ‚Äî basic app info
- `GET /actuator/scheduledtasks` ‚Äî view scheduled tasks
- `GET /h2-console` ‚Äî H2 database console (for development)

## How Automation Works

1. **Daily Schedule**: Runs automatically at 9 PM EST every day
2. **News Scraping**: Scrapes news from multiple free financial sources
3. **Sentiment Analysis**: Analyzes news sentiment using keyword-based scoring
4. **Recommendation Generation**: Creates buy/sell recommendations based on sentiment
5. **Risk Assessment**: Calculates risk levels and target prices
6. **Data Storage**: Saves recommendations to H2 database
7. **File Output**: Writes daily recommendations to timestamped text files
8. **API Access**: All data accessible via REST endpoints

## Install and run Ollama (macOS)
- With Homebrew (recommended):
```bash
brew install ollama
```
- Or download the mac app from `https://ollama.com` and open it once.

Start or verify the server and pull a model:
```bash
ollama serve            # if not using the GUI app; keep this running
ollama pull llama3.1:8b
ollama list
curl http://localhost:11434/api/tags
```

## Run with Docker
Build image and run the service container:
```bash
cd /Users/harmighl1/cursor-poc/stock-analyzer-spring
docker build -t stock-analyzer-spring .
docker run --rm -p 8085:8085 \
  -e OLLAMA_BASEURL=http://host.docker.internal:11434 \
  -e OLLAMA_MODEL=llama3.1:8b \
  stock-analyzer-spring
```

Then test:
```bash
curl "http://localhost:8085/analyze?symbol=AAPL"
curl "http://localhost:8085/api/automation/recommendations"
```

Note (macOS Docker): use `host.docker.internal` so the container can reach the Ollama server on the host.

## Troubleshooting
- "Unable to find application 'Ollama'" on macOS:
  - Install via Homebrew (`brew install ollama`) or install/open the app from the website.
  - Ensure the server is running: `ollama serve` and `curl http://localhost:11434/api/tags`.
- Connection refused to `http://localhost:11434`:
  - Make sure Ollama is running and a model is pulled.
  - If running the Spring app in Docker, set `OLLAMA_BASEURL=http://host.docker.internal:11434`.
- Non-200 from `/analyze`:
  - Verify the symbol exists and market data source is reachable.
  - Check service logs for stack traces.
- Automation not running:
  - Check logs for scheduling errors
  - Verify timezone settings (defaults to America/New_York)
  - Use manual trigger: `POST /api/automation/trigger-analysis`

## Development
- Build jar: `gradle bootJar`
- Run tests: `gradle test`
- Local run: `gradle bootRun`
- Database console: `http://localhost:8085/h2-console` (JDBC URL: `jdbc:h2:mem:stockanalyzer`)

The app runs on `http://localhost:8085` by default.
